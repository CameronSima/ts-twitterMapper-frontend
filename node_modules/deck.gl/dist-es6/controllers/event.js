export { _stop as stop };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

// event.js
// Handle keyboard/mouse/touch events in the Canvas
// TODO - this will not work under node

/* eslint-disable dot-notation, max-statements, no-loop-func */
/* global window, document */
import { noop } from '../utils';

var KEYS = {
  enter: 13,
  up: 38,
  down: 40,
  left: 37,
  right: 39,
  esc: 27,
  space: 32,
  backspace: 8,
  tab: 9,
  delete: 46
};

// returns an O3D object or false otherwise.
function toO3D(n) {
  return n !== true ? n : false;
}

// Returns an element position
function _getPos(elem) {
  var bbox = elem.getBoundingClientRect();
  return {
    x: bbox.left,
    y: bbox.top,
    bbox: bbox
  };
}

// event object wrapper
export function get(e, win) {
  win = win || window;
  return e || win.event;
}

export function getWheel(e) {
  return e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;
}

export function getKey(e) {
  var code = e.which || e.keyCode;
  var key = keyOf(code);
  // onkeydown
  var fKey = code - 111;
  if (fKey > 0 && fKey < 13) {
    key = 'f' + fKey;
  }
  key = key || String.fromCharCode(code).toLowerCase();

  return {
    code: code,
    key: key,
    shift: e.shiftKey,
    control: e.ctrlKey,
    alt: e.altKey,
    meta: e.metaKey
  };
}

export function isRightClick(e) {
  return e.which === 3 || e.button === 2;
}

export function getPos(e, win) {
  // get mouse position
  win = win || window;
  e = e || win.event;
  var doc = win.document;
  doc = doc.documentElement || doc.body;
  // TODO(nico): make touch event handling better
  if (e.touches && e.touches.length) {
    var touchesPos = [];
    var l = e.touches.length;
    var evt = void 0;
    for (var i = 0; i < l; ++i) {
      evt = e.touches[i];
      touchesPos.push({
        x: evt.pageX || evt.clientX + doc.scrollLeft,
        y: evt.pageY || evt.clientY + doc.scrollTop
      });
    }
    return touchesPos;
  }
  var page = {
    x: e.pageX || e.clientX + doc.scrollLeft,
    y: e.pageY || e.clientY + doc.scrollTop
  };
  return [page];
}

function _stop(e) {
  if (e.stopPropagation) {
    e.stopPropagation();
  }
  e.cancelBubble = true;
  if (e.preventDefault) {
    e.preventDefault();
  } else {
    e.returnValue = false;
  }
}

export var EventsProxy = function () {
  function EventsProxy(domElem, opt) {
    _classCallCheck(this, EventsProxy);

    this.scene = opt.scene;
    this.domElem = domElem;
    this.pos = _getPos(domElem);
    this.opt = this.callbacks = opt;

    this.size = {
      width: domElem.width || domElem.offsetWidth,
      height: domElem.height || domElem.offsetHeight
    };

    this.attachEvents();
  }

  _createClass(EventsProxy, [{
    key: 'attachEvents',
    value: function attachEvents() {
      var _this = this;

      var domElem = this.domElem;
      var opt = this.opt;

      if (opt.disableContextMenu) {
        domElem.oncontextmenu = function () {
          return false;
        };
      }

      if (opt.enableMouse) {
        ['mouseup', 'mousedown', 'mousemove', 'mouseover', 'mouseout'].forEach(function (action) {
          domElem.addEventListener(action, function (e, win) {
            _this[action](_this.eventInfo(action, e, win));
          }, false);
        });

        // "well, this is embarrassing..."
        var type = '';
        if (!document.getBoxObjectFor && window.mozInnerScreenX === null) {
          type = 'mousewheel';
        } else {
          type = 'DOMMouseScroll';
        }
        domElem.addEventListener(type, function (e, win) {
          _this['mousewheel'](_this.eventInfo('mousewheel', e, win));
        }, false);
      }

      if (opt.enableTouch) {
        ['touchstart', 'touchmove', 'touchend'].forEach(function (action) {
          domElem.addEventListener(action, function (e, win) {
            _this[action](_this.eventInfo(action, e, win));
          }, false);
        });
      }

      if (opt.enableKeyboard) {
        ['keydown', 'keyup'].forEach(function (action) {
          document.addEventListener(action, function (e, win) {
            _this[action](_this.eventInfo(action, e, win));
          }, false);
        });
      }
    }
  }, {
    key: 'eventInfo',
    value: function eventInfo(type, e, win) {
      var domElem = this.domElem;
      var scene = this.scene;
      var opt = this.opt;
      var size = this.getSize();
      var relative = opt.relative;
      var centerOrigin = opt.centerOrigin;
      var pos = opt.cachePosition && this.pos || _getPos(domElem);
      var ge = get(e, win);
      var epos = getPos(e, win);
      var origPos = { x: epos[0].x, y: epos[0].y };
      var evt = {};
      var x = void 0;
      var y = void 0;

      // get Position
      for (var i = 0, l = epos.length; i < l; ++i) {
        x = epos[i].x;
        y = epos[i].y;
        if (relative) {
          x -= pos.x;y -= pos.y;
          if (centerOrigin) {
            x -= size.width / 2;
            y -= size.height / 2;
            // y axis now points to the top of the screen
            y *= -1;
          }
        }
        epos[i].x = x;
        epos[i].y = y;
      }

      switch (type) {
        case 'mousewheel':
          evt.wheel = getWheel(ge);
          break;
        case 'keydown':
        case 'keyup':
          Object.assign(evt, getKey(ge));
          break;
        case 'mouseup':
          evt.isRightClick = isRightClick(ge);
          break;
        default:
          break;
      }

      var cacheTarget = void 0;

      Object.assign(evt, {
        x: epos[0].x,
        y: epos[0].y,
        posArray: epos,

        cache: false,
        // stop event propagation
        stop: function stop() {
          _stop(ge);
        },

        // get the target element of the event
        getTarget: function getTarget() {
          if (cacheTarget) {
            return cacheTarget;
          }
          return cacheTarget = opt.picking && scene.pick(origPos.x - pos.x, origPos.y - pos.y) || true;
        }
      });
      // wrap native event
      evt.event = ge;

      return evt;
    }
  }, {
    key: 'getSize',
    value: function getSize() {
      if (this.cacheSize) {
        return this.size;
      }
      var domElem = this.domElem;
      return {
        width: domElem.width || domElem.offsetWidth,
        height: domElem.height || domElem.offsetHeight
      };
    }
  }, {
    key: 'mouseup',
    value: function mouseup(e) {
      if (!this.moved) {
        if (e.isRightClick) {
          this.callbacks.onRightClick(e, this.hovered);
        } else {
          this.callbacks.onClick(e, toO3D(this.pressed));
        }
      }
      if (this.pressed) {
        if (this.moved) {
          this.callbacks.onDragEnd(e, toO3D(this.pressed));
        } else {
          this.callbacks.onDragCancel(e, toO3D(this.pressed));
        }
        this.pressed = this.moved = false;
      }
    }
  }, {
    key: 'mouseout',
    value: function mouseout(e) {
      // mouseout canvas
      var rt = e.relatedTarget;
      var domElem = this.domElem;
      while (rt && rt.parentNode) {
        if (domElem === rt.parentNode) {
          return;
        }
        rt = rt.parentNode;
      }
      if (this.hovered) {
        this.callbacks.onMouseLeave(e, this.hovered);
        this.hovered = false;
      }
      if (this.pressed && this.moved) {
        this.callbacks.onDragEnd(e);
        this.pressed = this.moved = false;
      }
    }
  }, {
    key: 'mouseover',
    value: function mouseover(e) {}
  }, {
    key: 'mousemove',
    value: function mousemove(e) {
      if (this.pressed) {
        this.moved = true;
        this.callbacks.onDragMove(e, toO3D(this.pressed));
        return;
      }
      if (this.hovered) {
        var target = toO3D(e.getTarget());
        if (!target || target.hash !== this.hash) {
          this.callbacks.onMouseLeave(e, this.hovered);
          this.hovered = target;
          this.hash = target;
          if (target) {
            this.hash = target.hash;
            this.callbacks.onMouseEnter(e, this.hovered);
          }
        } else {
          this.callbacks.onMouseMove(e, this.hovered);
        }
      } else {
        this.hovered = toO3D(e.getTarget());
        this.hash = this.hovered;
        if (this.hovered) {
          this.hash = this.hovered.hash;
          this.callbacks.onMouseEnter(e, this.hovered);
        }
      }
      if (!this.opt.picking) {
        this.callbacks.onMouseMove(e);
      }
    }
  }, {
    key: 'mousewheel',
    value: function mousewheel(e) {
      this.callbacks.onMouseWheel(e);
    }
  }, {
    key: 'mousedown',
    value: function mousedown(e) {
      this.pressed = e.getTarget();
      this.callbacks.onDragStart(e, toO3D(this.pressed));
    }
  }, {
    key: 'touchstart',
    value: function touchstart(e) {
      this.touched = e.getTarget();
      this.touchedLastPosition = { x: e.x, y: e.y };
      this.callbacks.onTouchStart(e, toO3D(this.touched));
    }
  }, {
    key: 'touchmove',
    value: function touchmove(e) {
      if (this.touched) {
        this.touchMoved = true;
        this.callbacks.onTouchMove(e, toO3D(this.touched));
      }
    }
  }, {
    key: 'touchend',
    value: function touchend(e) {
      if (this.touched) {
        if (this.touchMoved) {
          this.callbacks.onTouchEnd(e, toO3D(this.touched));
        } else {
          e.x = isNaN(e.x) ? this.touchedLastPosition.x : e.x;
          e.y = isNaN(e.y) ? this.touchedLastPosition.y : e.y;
          this.callbacks.onTap(e, toO3D(this.touched));
          this.callbacks.onTouchCancel(e, toO3D(this.touched));
        }
        this.touched = this.touchMoved = false;
      }
    }
  }, {
    key: 'keydown',
    value: function keydown(e) {
      this.callbacks.onKeyDown(e);
    }
  }, {
    key: 'keyup',
    value: function keyup(e) {
      this.callbacks.onKeyUp(e);
    }
  }]);

  return EventsProxy;
}();

Object.assign(EventsProxy.prototype, {
  hovered: false,
  pressed: false,
  touched: false,
  touchedLastPosition: { x: 0, y: 0 },
  touchMoved: false,
  moved: false
});

var DEFAULT_OPTS = {
  cachePosition: true,
  cacheSize: true,
  relative: true,
  centerOrigin: true,
  disableContextMenu: true,
  bind: false,
  picking: false,

  enableTouch: true,
  enableMouse: true,
  enableKeyboard: true,

  onClick: noop,
  onRightClick: noop,
  onDragStart: noop,
  onDragMove: noop,
  onDragEnd: noop,
  onDragCancel: noop,
  onTouchStart: noop,
  onTouchMove: noop,
  onTouchEnd: noop,
  onTouchCancel: noop,
  onTap: noop,
  onMouseMove: noop,
  onMouseEnter: noop,
  onMouseLeave: noop,
  onMouseWheel: noop,
  onKeyDown: noop,
  onKeyUp: noop
};

export var Keys = KEYS;

function keyOf(code) {
  var keyMap = Keys;
  for (var name in keyMap) {
    if (keyMap[name] === code) {
      return name;
    }
  }
  return null;
}

export function addEvents(domElement) {
  var opt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  opt = Object.assign({}, DEFAULT_OPTS, opt);

  var bind = opt.bind;
  if (bind) {
    for (var name in opt) {
      if (name.match(/^on[a-zA-Z0-9]+$/)) {
        (function (fname, fn) {
          opt[fname] = function f() {
            fn.apply(bind, Array.prototype.slice.call(arguments));
          };
        })(name, opt[name]);
      }
    }
  }

  return new EventsProxy(domElement, opt);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250cm9sbGVycy9ldmVudC5qcyJdLCJuYW1lcyI6WyJub29wIiwiS0VZUyIsImVudGVyIiwidXAiLCJkb3duIiwibGVmdCIsInJpZ2h0IiwiZXNjIiwic3BhY2UiLCJiYWNrc3BhY2UiLCJ0YWIiLCJkZWxldGUiLCJ0b08zRCIsIm4iLCJfZ2V0UG9zIiwiZWxlbSIsImJib3giLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ4IiwieSIsInRvcCIsImdldCIsImUiLCJ3aW4iLCJ3aW5kb3ciLCJldmVudCIsImdldFdoZWVsIiwid2hlZWxEZWx0YSIsImRldGFpbCIsImdldEtleSIsImNvZGUiLCJ3aGljaCIsImtleUNvZGUiLCJrZXkiLCJrZXlPZiIsImZLZXkiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJ0b0xvd2VyQ2FzZSIsInNoaWZ0Iiwic2hpZnRLZXkiLCJjb250cm9sIiwiY3RybEtleSIsImFsdCIsImFsdEtleSIsIm1ldGEiLCJtZXRhS2V5IiwiaXNSaWdodENsaWNrIiwiYnV0dG9uIiwiZ2V0UG9zIiwiZG9jIiwiZG9jdW1lbnQiLCJkb2N1bWVudEVsZW1lbnQiLCJib2R5IiwidG91Y2hlcyIsImxlbmd0aCIsInRvdWNoZXNQb3MiLCJsIiwiZXZ0IiwiaSIsInB1c2giLCJwYWdlWCIsImNsaWVudFgiLCJzY3JvbGxMZWZ0IiwicGFnZVkiLCJjbGllbnRZIiwic2Nyb2xsVG9wIiwicGFnZSIsInN0b3AiLCJzdG9wUHJvcGFnYXRpb24iLCJjYW5jZWxCdWJibGUiLCJwcmV2ZW50RGVmYXVsdCIsInJldHVyblZhbHVlIiwiRXZlbnRzUHJveHkiLCJkb21FbGVtIiwib3B0Iiwic2NlbmUiLCJwb3MiLCJjYWxsYmFja3MiLCJzaXplIiwid2lkdGgiLCJvZmZzZXRXaWR0aCIsImhlaWdodCIsIm9mZnNldEhlaWdodCIsImF0dGFjaEV2ZW50cyIsImRpc2FibGVDb250ZXh0TWVudSIsIm9uY29udGV4dG1lbnUiLCJlbmFibGVNb3VzZSIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwiYWN0aW9uIiwiZXZlbnRJbmZvIiwidHlwZSIsImdldEJveE9iamVjdEZvciIsIm1veklubmVyU2NyZWVuWCIsImVuYWJsZVRvdWNoIiwiZW5hYmxlS2V5Ym9hcmQiLCJnZXRTaXplIiwicmVsYXRpdmUiLCJjZW50ZXJPcmlnaW4iLCJjYWNoZVBvc2l0aW9uIiwiZ2UiLCJlcG9zIiwib3JpZ1BvcyIsIndoZWVsIiwiT2JqZWN0IiwiYXNzaWduIiwiY2FjaGVUYXJnZXQiLCJwb3NBcnJheSIsImNhY2hlIiwiZ2V0VGFyZ2V0IiwicGlja2luZyIsInBpY2siLCJjYWNoZVNpemUiLCJtb3ZlZCIsIm9uUmlnaHRDbGljayIsImhvdmVyZWQiLCJvbkNsaWNrIiwicHJlc3NlZCIsIm9uRHJhZ0VuZCIsIm9uRHJhZ0NhbmNlbCIsInJ0IiwicmVsYXRlZFRhcmdldCIsInBhcmVudE5vZGUiLCJvbk1vdXNlTGVhdmUiLCJvbkRyYWdNb3ZlIiwidGFyZ2V0IiwiaGFzaCIsIm9uTW91c2VFbnRlciIsIm9uTW91c2VNb3ZlIiwib25Nb3VzZVdoZWVsIiwib25EcmFnU3RhcnQiLCJ0b3VjaGVkIiwidG91Y2hlZExhc3RQb3NpdGlvbiIsIm9uVG91Y2hTdGFydCIsInRvdWNoTW92ZWQiLCJvblRvdWNoTW92ZSIsIm9uVG91Y2hFbmQiLCJpc05hTiIsIm9uVGFwIiwib25Ub3VjaENhbmNlbCIsIm9uS2V5RG93biIsIm9uS2V5VXAiLCJwcm90b3R5cGUiLCJERUZBVUxUX09QVFMiLCJiaW5kIiwiS2V5cyIsImtleU1hcCIsIm5hbWUiLCJhZGRFdmVudHMiLCJkb21FbGVtZW50IiwibWF0Y2giLCJmbmFtZSIsImZuIiwiZiIsImFwcGx5IiwiQXJyYXkiLCJzbGljZSIsImNhbGwiLCJhcmd1bWVudHMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUUEsSUFBUixRQUFtQixVQUFuQjs7QUFFQSxJQUFNQyxPQUFPO0FB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RCxXQUZEO0FBR0QsU0FKRCxFQUlHWCxJQUpILEVBSVN6RSxJQUFJeUUsSUFBSixDQUpUO0FBS0Q7QUFDRjtBQUNGOztBQUVELFNBQU8sSUFBSTNFLFdBQUosQ0FBZ0I2RSxVQUFoQixFQUE0QjNFLEdBQTVCLENBQVA7QUFDRCIsImZpbGUiOiJldmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGV2ZW50LmpzXG4vLyBIYW5kbGUga2V5Ym9hcmQvbW91c2UvdG91Y2ggZXZlbnRzIGluIHRoZSBDYW52YXNcbi8vIFRPRE8gLSB0aGlzIHdpbGwgbm90IHdvcmsgdW5kZXIgbm9kZVxuXG4vKiBlc2xpbnQtZGlzYWJsZSBkb3Qtbm90YXRpb24sIG1heC1zdGF0ZW1lbnRzLCBuby1sb29wLWZ1bmMgKi9cbi8qIGdsb2JhbCB3aW5kb3csIGRvY3VtZW50ICovXG5pbXBvcnQge25vb3B9IGZyb20gJy4uL3V0aWxzJztcblxuY29uc3QgS0VZUyA9IHtcbiAgZW50ZXI6IDEzLFxuICB1cDogMzgsXG4gIGRvd246IDQwLFxuICBsZWZ0OiAzNyxcbiAgcmlnaHQ6IDM5LFxuICBlc2M6IDI3LFxuICBzcGFjZTogMzIsXG4gIGJhY2tzcGFjZTogOCxcbiAgdGFiOiA5LFxuICBkZWxldGU6IDQ2XG59O1xuXG4vLyByZXR1cm5zIGFuIE8zRCBvYmplY3Qgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxuZnVuY3Rpb24gdG9PM0Qobikge1xuICByZXR1cm4gbiAhPT0gdHJ1ZSA/IG4gOiBmYWxzZTtcbn1cblxuLy8gUmV0dXJucyBhbiBlbGVtZW50IHBvc2l0aW9uXG5mdW5jdGlvbiBfZ2V0UG9zKGVsZW0pIHtcbiAgY29uc3QgYmJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIHJldHVybiB7XG4gICAgeDogYmJveC5sZWZ0LFxuICAgIHk6IGJib3gudG9wLFxuICAgIGJib3hcbiAgfTtcbn1cblxuLy8gZXZlbnQgb2JqZWN0IHdyYXBwZXJcbmV4cG9ydCBmdW5jdGlvbiBnZXQoZSwgd2luKSB7XG4gIHdpbiA9IHdpbiB8fCB3aW5kb3c7XG4gIHJldHVybiBlIHx8IHdpbi5ldmVudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFdoZWVsKGUpIHtcbiAgcmV0dXJuIGUud2hlZWxEZWx0YSA/IGUud2hlZWxEZWx0YSAvIDEyMCA6IC0oZS5kZXRhaWwgfHwgMCkgLyAzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0S2V5KGUpIHtcbiAgY29uc3QgY29kZSA9IGUud2hpY2ggfHwgZS5rZXlDb2RlO1xuICBsZXQga2V5ID0ga2V5T2YoY29kZSk7XG4gIC8vIG9ua2V5ZG93blxuICBjb25zdCBmS2V5ID0gY29kZSAtIDExMTtcbiAgaWYgKGZLZXkgPiAwICYmIGZLZXkgPCAxMykge1xuICAgIGtleSA9IGBmJHtmS2V5fWA7XG4gIH1cbiAga2V5ID0ga2V5IHx8IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkudG9Mb3dlckNhc2UoKTtcblxuICByZXR1cm4ge1xuICAgIGNvZGUsXG4gICAga2V5LFxuICAgIHNoaWZ0OiBlLnNoaWZ0S2V5LFxuICAgIGNvbnRyb2w6IGUuY3RybEtleSxcbiAgICBhbHQ6IGUuYWx0S2V5LFxuICAgIG1ldGE6IGUubWV0YUtleVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNSaWdodENsaWNrKGUpIHtcbiAgcmV0dXJuIGUud2hpY2ggPT09IDMgfHwgZS5idXR0b24gPT09IDI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQb3MoZSwgd2luKSB7XG4gIC8vIGdldCBtb3VzZSBwb3NpdGlvblxuICB3aW4gPSB3aW4gfHwgd2luZG93O1xuICBlID0gZSB8fCB3aW4uZXZlbnQ7XG4gIGxldCBkb2MgPSB3aW4uZG9jdW1lbnQ7XG4gIGRvYyA9IGRvYy5kb2N1bWVudEVsZW1lbnQgfHwgZG9jLmJvZHk7XG4gIC8vIFRPRE8obmljbyk6IG1ha2UgdG91Y2ggZXZlbnQgaGFuZGxpbmcgYmV0dGVyXG4gIGlmIChlLnRvdWNoZXMgJiYgZS50b3VjaGVzLmxlbmd0aCkge1xuICAgIGNvbnN0IHRvdWNoZXNQb3MgPSBbXTtcbiAgICBjb25zdCBsID0gZS50b3VjaGVzLmxlbmd0aDtcbiAgICBsZXQgZXZ0O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbDsgKytpKSB7XG4gICAgICBldnQgPSBlLnRvdWNoZXNbaV07XG4gICAgICB0b3VjaGVzUG9zLnB1c2goe1xuICAgICAgICB4OiBldnQucGFnZVggfHwgKGV2dC5jbGllbnRYICsgZG9jLnNjcm9sbExlZnQpLFxuICAgICAgICB5OiBldnQucGFnZVkgfHwgKGV2dC5jbGllbnRZICsgZG9jLnNjcm9sbFRvcClcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdG91Y2hlc1BvcztcbiAgfVxuICBjb25zdCBwYWdlID0ge1xuICAgIHg6IGUucGFnZVggfHwgKGUuY2xpZW50WCArIGRvYy5zY3JvbGxMZWZ0KSxcbiAgICB5OiBlLnBhZ2VZIHx8IChlLmNsaWVudFkgKyBkb2Muc2Nyb2xsVG9wKVxuICB9O1xuICByZXR1cm4gW3BhZ2VdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RvcChlKSB7XG4gIGlmIChlLnN0b3BQcm9wYWdhdGlvbikge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cbiAgZS5jYW5jZWxCdWJibGUgPSB0cnVlO1xuICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIHtcbiAgICBlLnJldHVyblZhbHVlID0gZmFsc2U7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEV2ZW50c1Byb3h5IHtcblxuICBjb25zdHJ1Y3Rvcihkb21FbGVtLCBvcHQpIHtcbiAgICB0aGlzLnNjZW5lID0gb3B0LnNjZW5lO1xuICAgIHRoaXMuZG9tRWxlbSA9IGRvbUVsZW07XG4gICAgdGhpcy5wb3MgPSBfZ2V0UG9zKGRvbUVsZW0pO1xuICAgIHRoaXMub3B0ID0gdGhpcy5jYWxsYmFja3MgPSBvcHQ7XG5cbiAgICB0aGlzLnNpemUgPSB7XG4gICAgICB3aWR0aDogZG9tRWxlbS53aWR0aCB8fCBkb21FbGVtLm9mZnNldFdpZHRoLFxuICAgICAgaGVpZ2h0OiBkb21FbGVtLmhlaWdodCB8fCBkb21FbGVtLm9mZnNldEhlaWdodFxuICAgIH07XG5cbiAgICB0aGlzLmF0dGFjaEV2ZW50cygpO1xuICB9XG5cbiAgYXR0YWNoRXZlbnRzKCkge1xuICAgIGNvbnN0IGRvbUVsZW0gPSB0aGlzLmRvbUVsZW07XG4gICAgY29uc3Qgb3B0ID0gdGhpcy5vcHQ7XG5cbiAgICBpZiAob3B0LmRpc2FibGVDb250ZXh0TWVudSkge1xuICAgICAgZG9tRWxlbS5vbmNvbnRleHRtZW51ID0gKCkgPT4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKG9wdC5lbmFibGVNb3VzZSkge1xuICAgICAgWydtb3VzZXVwJywgJ21vdXNlZG93bicsICdtb3VzZW1vdmUnLCAnbW91c2VvdmVyJywgJ21vdXNlb3V0J11cbiAgICAgIC5mb3JFYWNoKGFjdGlvbiA9PiB7XG4gICAgICAgIGRvbUVsZW0uYWRkRXZlbnRMaXN0ZW5lcihhY3Rpb24sIChlLCB3aW4pID0+IHtcbiAgICAgICAgICB0aGlzW2FjdGlvbl0odGhpcy5ldmVudEluZm8oYWN0aW9uLCBlLCB3aW4pKTtcbiAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFwid2VsbCwgdGhpcyBpcyBlbWJhcnJhc3NpbmcuLi5cIlxuICAgICAgbGV0IHR5cGUgPSAnJztcbiAgICAgIGlmICghZG9jdW1lbnQuZ2V0Qm94T2JqZWN0Rm9yICYmIHdpbmRvdy5tb3pJbm5lclNjcmVlblggPT09IG51bGwpIHtcbiAgICAgICAgdHlwZSA9ICdtb3VzZXdoZWVsJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHR5cGUgPSAnRE9NTW91c2VTY3JvbGwnO1xuICAgICAgfVxuICAgICAgZG9tRWxlbS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIChlLCB3aW4pID0+IHtcbiAgICAgICAgdGhpc1snbW91c2V3aGVlbCddKHRoaXMuZXZlbnRJbmZvKCdtb3VzZXdoZWVsJywgZSwgd2luKSk7XG4gICAgICB9LCBmYWxzZSk7XG4gICAgfVxuXG4gICAgaWYgKG9wdC5lbmFibGVUb3VjaCkge1xuICAgICAgWyd0b3VjaHN0YXJ0JywgJ3RvdWNobW92ZScsICd0b3VjaGVuZCddLmZvckVhY2goYWN0aW9uID0+IHtcbiAgICAgICAgZG9tRWxlbS5hZGRFdmVudExpc3RlbmVyKGFjdGlvbiwgKGUsIHdpbikgPT4ge1xuICAgICAgICAgIHRoaXNbYWN0aW9uXSh0aGlzLmV2ZW50SW5mbyhhY3Rpb24sIGUsIHdpbikpO1xuICAgICAgICB9LCBmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAob3B0LmVuYWJsZUtleWJvYXJkKSB7XG4gICAgICBbJ2tleWRvd24nLCAna2V5dXAnXS5mb3JFYWNoKGFjdGlvbiA9PiB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoYWN0aW9uLCAoZSwgd2luKSA9PiB7XG4gICAgICAgICAgdGhpc1thY3Rpb25dKHRoaXMuZXZlbnRJbmZvKGFjdGlvbiwgZSwgd2luKSk7XG4gICAgICAgIH0sIGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGV2ZW50SW5mbyh0eXBlLCBlLCB3aW4pIHtcbiAgICBjb25zdCBkb21FbGVtID0gdGhpcy5kb21FbGVtO1xuICAgIGNvbnN0IHNjZW5lID0gdGhpcy5zY2VuZTtcbiAgICBjb25zdCBvcHQgPSB0aGlzLm9wdDtcbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRTaXplKCk7XG4gICAgY29uc3QgcmVsYXRpdmUgPSBvcHQucmVsYXRpdmU7XG4gICAgY29uc3QgY2VudGVyT3JpZ2luID0gb3B0LmNlbnRlck9yaWdpbjtcbiAgICBjb25zdCBwb3MgPSBvcHQuY2FjaGVQb3NpdGlvbiAmJiB0aGlzLnBvcyB8fCBfZ2V0UG9zKGRvbUVsZW0pO1xuICAgIGNvbnN0IGdlID0gZ2V0KGUsIHdpbik7XG4gICAgY29uc3QgZXBvcyA9IGdldFBvcyhlLCB3aW4pO1xuICAgIGNvbnN0IG9yaWdQb3MgPSB7eDogZXBvc1swXS54LCB5OiBlcG9zWzBdLnl9O1xuICAgIGNvbnN0IGV2dCA9IHt9O1xuICAgIGxldCB4O1xuICAgIGxldCB5O1xuXG4gICAgLy8gZ2V0IFBvc2l0aW9uXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSBlcG9zLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgeCA9IGVwb3NbaV0ueDtcbiAgICAgIHkgPSBlcG9zW2ldLnk7XG4gICAgICBpZiAocmVsYXRpdmUpIHtcbiAgICAgICAgeCAtPSBwb3MueDsgeSAtPSBwb3MueTtcbiAgICAgICAgaWYgKGNlbnRlck9yaWdpbikge1xuICAgICAgICAgIHggLT0gc2l6ZS53aWR0aCAvIDI7XG4gICAgICAgICAgeSAtPSBzaXplLmhlaWdodCAvIDI7XG4gICAgICAgICAgLy8geSBheGlzIG5vdyBwb2ludHMgdG8gdGhlIHRvcCBvZiB0aGUgc2NyZWVuXG4gICAgICAgICAgeSAqPSAtMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZXBvc1tpXS54ID0geDtcbiAgICAgIGVwb3NbaV0ueSA9IHk7XG4gICAgfVxuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSAnbW91c2V3aGVlbCc6XG4gICAgICBldnQud2hlZWwgPSBnZXRXaGVlbChnZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdrZXlkb3duJzpcbiAgICBjYXNlICdrZXl1cCc6XG4gICAgICBPYmplY3QuYXNzaWduKGV2dCwgZ2V0S2V5KGdlKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdtb3VzZXVwJzpcbiAgICAgIGV2dC5pc1JpZ2h0Q2xpY2sgPSBpc1JpZ2h0Q2xpY2soZ2UpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGxldCBjYWNoZVRhcmdldDtcblxuICAgIE9iamVjdC5hc3NpZ24oZXZ0LCB7XG4gICAgICB4OiBlcG9zWzBdLngsXG4gICAgICB5OiBlcG9zWzBdLnksXG4gICAgICBwb3NBcnJheTogZXBvcyxcblxuICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgLy8gc3RvcCBldmVudCBwcm9wYWdhdGlvblxuICAgICAgc3RvcCgpIHtcbiAgICAgICAgc3RvcChnZSk7XG4gICAgICB9LFxuICAgICAgLy8gZ2V0IHRoZSB0YXJnZXQgZWxlbWVudCBvZiB0aGUgZXZlbnRcbiAgICAgIGdldFRhcmdldCgpIHtcbiAgICAgICAgaWYgKGNhY2hlVGFyZ2V0KSB7XG4gICAgICAgICAgcmV0dXJuIGNhY2hlVGFyZ2V0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoY2FjaGVUYXJnZXQgPSBvcHQucGlja2luZyAmJlxuICAgICAgICAgIHNjZW5lLnBpY2sob3JpZ1Bvcy54IC0gcG9zLngsIG9yaWdQb3MueSAtIHBvcy55KSB8fCB0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyB3cmFwIG5hdGl2ZSBldmVudFxuICAgIGV2dC5ldmVudCA9IGdlO1xuXG4gICAgcmV0dXJuIGV2dDtcbiAgfVxuXG4gIGdldFNpemUoKSB7XG4gICAgaWYgKHRoaXMuY2FjaGVTaXplKSB7XG4gICAgICByZXR1cm4gdGhpcy5zaXplO1xuICAgIH1cbiAgICBjb25zdCBkb21FbGVtID0gdGhpcy5kb21FbGVtO1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogZG9tRWxlbS53aWR0aCB8fCBkb21FbGVtLm9mZnNldFdpZHRoLFxuICAgICAgaGVpZ2h0OiBkb21FbGVtLmhlaWdodCB8fCBkb21FbGVtLm9mZnNldEhlaWdodFxuICAgIH07XG4gIH1cblxuICBtb3VzZXVwKGUpIHtcbiAgICBpZiAoIXRoaXMubW92ZWQpIHtcbiAgICAgIGlmIChlLmlzUmlnaHRDbGljaykge1xuICAgICAgICB0aGlzLmNhbGxiYWNrcy5vblJpZ2h0Q2xpY2soZSwgdGhpcy5ob3ZlcmVkKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uQ2xpY2soZSwgdG9PM0QodGhpcy5wcmVzc2VkKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLnByZXNzZWQpIHtcbiAgICAgIGlmICh0aGlzLm1vdmVkKSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uRHJhZ0VuZChlLCB0b08zRCh0aGlzLnByZXNzZWQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uRHJhZ0NhbmNlbChlLCB0b08zRCh0aGlzLnByZXNzZWQpKTtcbiAgICAgIH1cbiAgICAgIHRoaXMucHJlc3NlZCA9IHRoaXMubW92ZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBtb3VzZW91dChlKSB7XG4gICAgLy8gbW91c2VvdXQgY2FudmFzXG4gICAgbGV0IHJ0ID0gZS5yZWxhdGVkVGFyZ2V0O1xuICAgIGNvbnN0IGRvbUVsZW0gPSB0aGlzLmRvbUVsZW07XG4gICAgd2hpbGUgKHJ0ICYmIHJ0LnBhcmVudE5vZGUpIHtcbiAgICAgIGlmIChkb21FbGVtID09PSBydC5wYXJlbnROb2RlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHJ0ID0gcnQucGFyZW50Tm9kZTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaG92ZXJlZCkge1xuICAgICAgdGhpcy5jYWxsYmFja3Mub25Nb3VzZUxlYXZlKGUsIHRoaXMuaG92ZXJlZCk7XG4gICAgICB0aGlzLmhvdmVyZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJlc3NlZCAmJiB0aGlzLm1vdmVkKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrcy5vbkRyYWdFbmQoZSk7XG4gICAgICB0aGlzLnByZXNzZWQgPSB0aGlzLm1vdmVkID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgbW91c2VvdmVyKGUpIHtcbiAgfVxuXG4gIG1vdXNlbW92ZShlKSB7XG4gICAgaWYgKHRoaXMucHJlc3NlZCkge1xuICAgICAgdGhpcy5tb3ZlZCA9IHRydWU7XG4gICAgICB0aGlzLmNhbGxiYWNrcy5vbkRyYWdNb3ZlKGUsIHRvTzNEKHRoaXMucHJlc3NlZCkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5ob3ZlcmVkKSB7XG4gICAgICBjb25zdCB0YXJnZXQgPSB0b08zRChlLmdldFRhcmdldCgpKTtcbiAgICAgIGlmICghdGFyZ2V0IHx8IHRhcmdldC5oYXNoICE9PSB0aGlzLmhhc2gpIHtcbiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25Nb3VzZUxlYXZlKGUsIHRoaXMuaG92ZXJlZCk7XG4gICAgICAgIHRoaXMuaG92ZXJlZCA9IHRhcmdldDtcbiAgICAgICAgdGhpcy5oYXNoID0gdGFyZ2V0O1xuICAgICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgICAgdGhpcy5oYXNoID0gdGFyZ2V0Lmhhc2g7XG4gICAgICAgICAgdGhpcy5jYWxsYmFja3Mub25Nb3VzZUVudGVyKGUsIHRoaXMuaG92ZXJlZCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uTW91c2VNb3ZlKGUsIHRoaXMuaG92ZXJlZCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaG92ZXJlZCA9IHRvTzNEKGUuZ2V0VGFyZ2V0KCkpO1xuICAgICAgdGhpcy5oYXNoID0gdGhpcy5ob3ZlcmVkO1xuICAgICAgaWYgKHRoaXMuaG92ZXJlZCkge1xuICAgICAgICB0aGlzLmhhc2ggPSB0aGlzLmhvdmVyZWQuaGFzaDtcbiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25Nb3VzZUVudGVyKGUsIHRoaXMuaG92ZXJlZCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghdGhpcy5vcHQucGlja2luZykge1xuICAgICAgdGhpcy5jYWxsYmFja3Mub25Nb3VzZU1vdmUoZSk7XG4gICAgfVxuICB9XG5cbiAgbW91c2V3aGVlbChlKSB7XG4gICAgdGhpcy5jYWxsYmFja3Mub25Nb3VzZVdoZWVsKGUpO1xuICB9XG5cbiAgbW91c2Vkb3duKGUpIHtcbiAgICB0aGlzLnByZXNzZWQgPSBlLmdldFRhcmdldCgpO1xuICAgIHRoaXMuY2FsbGJhY2tzLm9uRHJhZ1N0YXJ0KGUsIHRvTzNEKHRoaXMucHJlc3NlZCkpO1xuICB9XG5cbiAgdG91Y2hzdGFydChlKSB7XG4gICAgdGhpcy50b3VjaGVkID0gZS5nZXRUYXJnZXQoKTtcbiAgICB0aGlzLnRvdWNoZWRMYXN0UG9zaXRpb24gPSB7eDogZS54LCB5OiBlLnl9O1xuICAgIHRoaXMuY2FsbGJhY2tzLm9uVG91Y2hTdGFydChlLCB0b08zRCh0aGlzLnRvdWNoZWQpKTtcbiAgfVxuXG4gIHRvdWNobW92ZShlKSB7XG4gICAgaWYgKHRoaXMudG91Y2hlZCkge1xuICAgICAgdGhpcy50b3VjaE1vdmVkID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVG91Y2hNb3ZlKGUsIHRvTzNEKHRoaXMudG91Y2hlZCkpO1xuICAgIH1cbiAgfVxuXG4gIHRvdWNoZW5kKGUpIHtcbiAgICBpZiAodGhpcy50b3VjaGVkKSB7XG4gICAgICBpZiAodGhpcy50b3VjaE1vdmVkKSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVG91Y2hFbmQoZSwgdG9PM0QodGhpcy50b3VjaGVkKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlLnggPSBpc05hTihlLngpID8gdGhpcy50b3VjaGVkTGFzdFBvc2l0aW9uLnggOiBlLng7XG4gICAgICAgIGUueSA9IGlzTmFOKGUueSkgPyB0aGlzLnRvdWNoZWRMYXN0UG9zaXRpb24ueSA6IGUueTtcbiAgICAgICAgdGhpcy5jYWxsYmFja3Mub25UYXAoZSwgdG9PM0QodGhpcy50b3VjaGVkKSk7XG4gICAgICAgIHRoaXMuY2FsbGJhY2tzLm9uVG91Y2hDYW5jZWwoZSwgdG9PM0QodGhpcy50b3VjaGVkKSk7XG4gICAgICB9XG4gICAgICB0aGlzLnRvdWNoZWQgPSB0aGlzLnRvdWNoTW92ZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBrZXlkb3duKGUpIHtcbiAgICB0aGlzLmNhbGxiYWNrcy5vbktleURvd24oZSk7XG4gIH1cblxuICBrZXl1cChlKSB7XG4gICAgdGhpcy5jYWxsYmFja3Mub25LZXlVcChlKTtcbiAgfVxufVxuXG5PYmplY3QuYXNzaWduKEV2ZW50c1Byb3h5LnByb3RvdHlwZSwge1xuICBob3ZlcmVkOiBmYWxzZSxcbiAgcHJlc3NlZDogZmFsc2UsXG4gIHRvdWNoZWQ6IGZhbHNlLFxuICB0b3VjaGVkTGFzdFBvc2l0aW9uOiB7eDogMCwgeTogMH0sXG4gIHRvdWNoTW92ZWQ6IGZhbHNlLFxuICBtb3ZlZDogZmFsc2Vcbn0pO1xuXG5jb25zdCBERUZBVUxUX09QVFMgPSB7XG4gIGNhY2hlUG9zaXRpb246IHRydWUsXG4gIGNhY2hlU2l6ZTogdHJ1ZSxcbiAgcmVsYXRpdmU6IHRydWUsXG4gIGNlbnRlck9yaWdpbjogdHJ1ZSxcbiAgZGlzYWJsZUNvbnRleHRNZW51OiB0cnVlLFxuICBiaW5kOiBmYWxzZSxcbiAgcGlja2luZzogZmFsc2UsXG5cbiAgZW5hYmxlVG91Y2g6IHRydWUsXG4gIGVuYWJsZU1vdXNlOiB0cnVlLFxuICBlbmFibGVLZXlib2FyZDogdHJ1ZSxcblxuICBvbkNsaWNrOiBub29wLFxuICBvblJpZ2h0Q2xpY2s6IG5vb3AsXG4gIG9uRHJhZ1N0YXJ0OiBub29wLFxuICBvbkRyYWdNb3ZlOiBub29wLFxuICBvbkRyYWdFbmQ6IG5vb3AsXG4gIG9uRHJhZ0NhbmNlbDogbm9vcCxcbiAgb25Ub3VjaFN0YXJ0OiBub29wLFxuICBvblRvdWNoTW92ZTogbm9vcCxcbiAgb25Ub3VjaEVuZDogbm9vcCxcbiAgb25Ub3VjaENhbmNlbDogbm9vcCxcbiAgb25UYXA6IG5vb3AsXG4gIG9uTW91c2VNb3ZlOiBub29wLFxuICBvbk1vdXNlRW50ZXI6IG5vb3AsXG4gIG9uTW91c2VMZWF2ZTogbm9vcCxcbiAgb25Nb3VzZVdoZWVsOiBub29wLFxuICBvbktleURvd246IG5vb3AsXG4gIG9uS2V5VXA6IG5vb3Bcbn07XG5cbmV4cG9ydCBjb25zdCBLZXlzID0gS0VZUztcblxuZnVuY3Rpb24ga2V5T2YoY29kZSkge1xuICBjb25zdCBrZXlNYXAgPSBLZXlzO1xuICBmb3IgKGNvbnN0IG5hbWUgaW4ga2V5TWFwKSB7XG4gICAgaWYgKGtleU1hcFtuYW1lXSA9PT0gY29kZSkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkRXZlbnRzKGRvbUVsZW1lbnQsIG9wdCA9IHt9KSB7XG4gIG9wdCA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfT1BUUywgb3B0KTtcblxuICBjb25zdCBiaW5kID0gb3B0LmJpbmQ7XG4gIGlmIChiaW5kKSB7XG4gICAgZm9yIChjb25zdCBuYW1lIGluIG9wdCkge1xuICAgICAgaWYgKG5hbWUubWF0Y2goL15vblthLXpBLVowLTldKyQvKSkge1xuICAgICAgICAoKGZuYW1lLCBmbikgPT4ge1xuICAgICAgICAgIG9wdFtmbmFtZV0gPSBmdW5jdGlvbiBmKCkge1xuICAgICAgICAgICAgZm4uYXBwbHkoYmluZCwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkobmFtZSwgb3B0W25hbWVdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbmV3IEV2ZW50c1Byb3h5KGRvbUVsZW1lbnQsIG9wdCk7XG59XG4iXX0=